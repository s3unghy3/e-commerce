"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[560],{3560:(K,k,l)=>{l.r(k),l.d(k,{CheckoutModule:()=>W});var m=l(8583),v=l(3318);function C(r,o,e,n){return new(e||(e=Promise))(function(i,c){function u(f){try{s(n.next(f))}catch(y){c(y)}}function h(f){try{s(n.throw(f))}catch(y){c(y)}}function s(f){f.done?i(f.value):function(i){return i instanceof e?i:new e(function(c){c(i)})}(f.value).then(u,h)}s((n=n.apply(r,o||[])).next())})}var d=l(665),t=l(3018),O=l(8002),E=l(2340),F=l(1841);let N=(()=>{class r{constructor(e){this.http=e,this.baseUrl=E.N.apiUrl}createOrder(e){return this.http.post(this.baseUrl+"orders",e)}getDeliveryMethods(){return this.http.get(this.baseUrl+"orders/deliveryMethods").pipe((0,O.U)(e=>e.sort((n,a)=>a.price-n.price)))}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(F.eN))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var U=l(4878),I=l(9508),q=l(9344),P=l(3449),M=l(4015),j=l(9281);const J=["cardNumber"],R=["cardExpiry"],V=["cardCvc"];function G(r,o){if(1&r){const e=t.EpF();t.TgZ(0,"div",35),t.TgZ(1,"input",36),t.NdJ("click",function(){const i=t.CHM(e).$implicit;return t.oxw().setShippingPrice(i)}),t.qZA(),t.TgZ(2,"label",37),t.TgZ(3,"strong"),t._uU(4),t.ALo(5,"currency"),t.qZA(),t._UZ(6,"br"),t.TgZ(7,"span",38),t._uU(8),t.qZA(),t.qZA(),t.qZA()}if(2&r){const e=o.$implicit;t.xp6(1),t.s9C("id",e.id),t.s9C("value",e.id),t.xp6(1),t.s9C("for",e.id),t.xp6(2),t.AsE("",e.shortName," - ",t.xi3(5,6,e.price,"EUR"),""),t.xp6(4),t.Oqu(e.description)}}function L(r,o){if(1&r&&(t.ynx(0),t.TgZ(1,"span",39),t._uU(2),t.qZA(),t.BQk()),2&r){const e=t.oxw();t.xp6(2),t.Oqu(e.cardErrors)}}function Q(r,o){if(1&r&&(t._UZ(0,"app-order-totals",40),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async")),2&r){const e=t.oxw();t.Q6J("shippingPrice",t.lcZ(1,3,e.basketTotals$).shipping)("subtotal",t.lcZ(2,5,e.basketTotals$).subtotal)("total",t.lcZ(3,7,e.basketTotals$).total)}}function D(r,o){if(1&r&&(t.TgZ(0,"button",5),t._uU(1,"View your order"),t.qZA()),2&r){const e=t.oxw();t.MGl("routerLink","/orders/",null==e.order?null:e.order.id,"")}}function B(r,o){1&r&&(t.TgZ(0,"button",6),t._uU(1,"View your orders"),t.qZA())}const $=[{path:"",component:(()=>{class r{constructor(e,n,a,i,c,u){this.router=e,this.checkoutService=n,this.fb=a,this.accountService=i,this.basketService=c,this.toastr=u,this.cardHandler=this.onChange.bind(this),this.cardNumberValid=!1,this.cardExpiryValid=!1,this.cardCvcValid=!1}ngOnInit(){this.createCheckoutForm(),this.getAddressFormValues(),this.getDeliveryMethodValue(),this.basket$=this.basketService.basket$,this.basketTotals$=this.basketService.basketTotal$,this.checkoutService.getDeliveryMethods().subscribe(e=>{this.deliveryMethods=e},e=>{console.log(e)})}createCheckoutForm(){this.checkoutForm=this.fb.group({addressForm:this.fb.group({firstName:[null,d.kI.required],lastName:[null,d.kI.required],street:[null,d.kI.required],city:[null,d.kI.required],state:[null,d.kI.required],zipCode:[null,d.kI.required]}),deliveryForm:this.fb.group({deliveryMethod:[null,d.kI.required]}),paymentForm:this.fb.group({nameOnCard:[null,d.kI.required]})})}getAddressFormValues(){this.accountService.getUserAddress().subscribe(e=>{e&&this.checkoutForm.get("addressForm").patchValue(e)},e=>{console.log(e)})}getDeliveryMethodValue(){const e=this.basketService.getCurrentBasketValue();null!=e.deliveryMethodId&&this.checkoutForm.get("deliveryForm").get("deliveryMethod").patchValue(e.deliveryMethodId.toString())}createPaymentIntent(){return this.basketService.createPaymentIntent().subscribe(e=>{},e=>{console.log(e)})}setShippingPrice(e){this.basketService.setShippingPrice(e)}saveUserAddress(){this.accountService.updateUserAddress(this.checkoutForm.get("addressForm").value).subscribe(e=>{this.toastr.success("Address saved"),this.checkoutForm.get("addressForm").reset(e)},e=>{this.toastr.error(e.message),console.log(e)})}ngAfterViewInit(){this.stripe=Stripe("pk_test_51Jae0yBODOlY5TO8aCdx6xjmmgSnwwNx5ERb69f3oW0AWUY0qJ1ods7OjnbLruF7GFdEGXAUtXXGyI7h8XCUdax000U3KBLN2d");const e=this.stripe.elements();this.cardNumber=e.create("cardNumber"),this.cardNumber.mount(this.cardNumberElement.nativeElement),this.cardNumber.addEventListener("change",this.cardHandler),this.cardExpiry=e.create("cardExpiry"),this.cardExpiry.mount(this.cardExpiryElement.nativeElement),this.cardExpiry.addEventListener("change",this.cardHandler),this.cardCvc=e.create("cardCvc"),this.cardCvc.mount(this.cardCvcElement.nativeElement),this.cardCvc.addEventListener("change",this.cardHandler)}ngOnDestroy(){this.cardNumber.destroy(),this.cardExpiry.destroy(),this.cardCvc.destroy()}onChange(e){switch(this.cardErrors=e.error?e.error.message:null,e.elementType){case"cardNumber":this.cardNumberValid=e.complete;break;case"cardExpiry":this.cardExpiryValid=e.complete;break;case"cardCvc":this.cardCvcValid=e.complete}}submitOrder(){return C(this,void 0,void 0,function*(){const e=this.basketService.getCurrentBasketValue();try{const n=yield this.createOrder(e),a=yield this.confirmPaymentWithStripe(e);a.paymentIntent?(this.basketService.deleteBasket(e),this.router.navigate(["checkout/success"],{state:n})):this.toastr.error(a.error.message)}catch(n){console.log(n)}})}confirmPaymentWithStripe(e){return C(this,void 0,void 0,function*(){return this.stripe.confirmCardPayment(e.clientSecret,{payment_method:{card:this.cardNumber,billing_details:{name:this.checkoutForm.get("paymentForm").get("nameOnCard").value}}})})}createOrder(e){return C(this,void 0,void 0,function*(){const n=this.getOrderToCreate(e);return this.checkoutService.createOrder(n).toPromise()})}getOrderToCreate(e){return{basketId:e.id,deliveryMethodId:+this.checkoutForm.get("deliveryForm").get("deliveryMethod").value,shipToAddress:this.checkoutForm.get("addressForm").value}}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(v.F0),t.Y36(N),t.Y36(d.qu),t.Y36(U.B),t.Y36(I.v),t.Y36(q._W))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-checkout"]],viewQuery:function(e,n){if(1&e&&(t.Gf(J,7),t.Gf(R,7),t.Gf(V,7)),2&e){let a;t.iGM(a=t.CRH())&&(n.cardNumberElement=a.first),t.iGM(a=t.CRH())&&(n.cardExpiryElement=a.first),t.iGM(a=t.CRH())&&(n.cardCvcElement=a.first)}},inputs:{checkoutForm:"checkoutForm"},decls:55,vars:21,consts:[[1,"container",2,"margin-top","100px"],[1,"row"],[1,"col-6",2,"margin-right","20px","padding","15px"],[2,"background-color","#0099cc","color","white","padding","5px"],[1,"mt-4"],[3,"isBasket","items"],[1,"mt-3",3,"formGroup"],[1,"mb-3",2,"background-color","#0099cc","color","white","padding","5px"],["formGroupName","deliveryForm",1,"row","mt-3",2,"margin-left","20px"],["class","col-6 form-group",4,"ngFor","ngForOf"],[1,"mt-4",3,"formGroup"],[2,"right","0px","position","absolute","padding-right","15px","padding-top","10px"],[1,"btn","btn-outline-success","mb-3",3,"disabled","click"],["formGroupName","addressForm",1,"row",2,"margin-top","70px"],[1,"form-group","col-6"],["formControlName","firstName",3,"label"],["formControlName","lastName",3,"label"],["formControlName","street",3,"label"],["formControlName","city",3,"label"],["formControlName","state",3,"label"],["formControlName","zipCode",3,"label"],[1,"col",2,"padding","15px"],[1,"mt-4",2,"margin-bottom","10px",3,"formGroup"],["formGroupName","paymentForm",1,"form-group","col-12"],["formControlName","nameOnCard",3,"label"],[1,"form-group","row-6"],[1,"form-control","py-3"],["cardNumber",""],[4,"ngIf"],["cardExpiry",""],["cardCvc",""],[1,"btn","btn-primary",3,"disabled","click"],[1,"fa","fa-angle-right"],[1,"row-5",2,"margin-top","40px"],[3,"shippingPrice","subtotal","total",4,"ngIf"],[1,"col-6","form-group"],["type","radio","formControlName","deliveryMethod",1,"custom-control-input",3,"id","value","click"],[1,"custom-control-label",3,"for"],[1,"label-description"],[1,"text-danger"],[3,"shippingPrice","subtotal","total"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"h6",3),t._uU(4,"1. REVIEW YOUR ORDER"),t.qZA(),t.TgZ(5,"div",4),t._UZ(6,"app-basket-summary",5),t.ALo(7,"async"),t.qZA(),t.TgZ(8,"div",6),t.TgZ(9,"h6",7),t._uU(10,"2. DELIVERY OPTION"),t.qZA(),t.TgZ(11,"div",8),t.YNc(12,G,9,9,"div",9),t.qZA(),t.qZA(),t.TgZ(13,"div",10),t.TgZ(14,"h6",3),t._uU(15,"3. DELIVERY ADDRESS"),t.qZA(),t.TgZ(16,"div",11),t.TgZ(17,"button",12),t.NdJ("click",function(){return n.saveUserAddress()}),t._uU(18," Save as default address "),t.qZA(),t.qZA(),t.TgZ(19,"div",13),t.TgZ(20,"div",14),t._UZ(21,"app-text-input",15),t.qZA(),t.TgZ(22,"div",14),t._UZ(23,"app-text-input",16),t.qZA(),t.TgZ(24,"div",14),t._UZ(25,"app-text-input",17),t.qZA(),t.TgZ(26,"div",14),t._UZ(27,"app-text-input",18),t.qZA(),t.TgZ(28,"div",14),t._UZ(29,"app-text-input",19),t.qZA(),t.TgZ(30,"div",14),t._UZ(31,"app-text-input",20),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(32,"div",21),t.TgZ(33,"h6",3),t._uU(34,"4. PAYMENT"),t.qZA(),t.TgZ(35,"div",22),t.TgZ(36,"div",1),t.TgZ(37,"div",23),t._UZ(38,"app-text-input",24),t.qZA(),t.TgZ(39,"div",25),t._UZ(40,"div",26,27),t.YNc(42,L,3,1,"ng-container",28),t.qZA(),t.TgZ(43,"div",14),t._UZ(44,"div",26,29),t.qZA(),t.TgZ(46,"div",14),t._UZ(47,"div",26,30),t.qZA(),t.qZA(),t.qZA(),t.TgZ(49,"button",31),t.NdJ("click",function(){return n.submitOrder()}),t._uU(50," PLACE ORDER "),t._UZ(51,"i",32),t.qZA(),t.TgZ(52,"div",33),t.YNc(53,Q,4,9,"app-order-totals",34),t.ALo(54,"async"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Q6J("isBasket",!1)("items",t.lcZ(7,17,n.basket$).items),t.xp6(2),t.Q6J("formGroup",n.checkoutForm),t.xp6(4),t.Q6J("ngForOf",n.deliveryMethods),t.xp6(1),t.Q6J("formGroup",n.checkoutForm),t.xp6(4),t.Q6J("disabled",!n.checkoutForm.get("addressForm").valid||!n.checkoutForm.get("addressForm").dirty),t.xp6(4),t.Q6J("label","First name"),t.xp6(2),t.Q6J("label","Last name"),t.xp6(2),t.Q6J("label","Street"),t.xp6(2),t.Q6J("label","City"),t.xp6(2),t.Q6J("label","State"),t.xp6(2),t.Q6J("label","Zip code"),t.xp6(4),t.Q6J("formGroup",n.checkoutForm),t.xp6(3),t.Q6J("label","Name on card"),t.xp6(4),t.Q6J("ngIf",n.cardErrors),t.xp6(7),t.Q6J("disabled",n.checkoutForm.get("paymentForm").invalid||n.checkoutForm.get("deliveryForm").invalid||!n.cardNumberValid||!n.cardExpiryValid||!n.cardCvcValid),t.xp6(4),t.Q6J("ngIf",t.lcZ(54,19,n.basketTotals$)))},directives:[P.b,d.JL,d.sg,d.x0,m.sg,M.t,d.JJ,d.u,m.O5,d._,d.Fj,j.S],pipes:[m.Ov,m.H9],encapsulation:2}),r})()},{path:"success",component:(()=>{class r{constructor(e){this.router=e;const n=this.router.getCurrentNavigation(),a=n&&n.extras&&n.extras.state;a&&(this.order=a)}ngOnInit(){}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(v.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-checkout-success"]],decls:9,vars:2,consts:[[1,"container","mt-5",2,"margin-bottom","220px","padding-top","120px"],[1,"fa","fa-check-circle","fa-5x",2,"color","#0099cc"],[1,"mb-4"],["class","btn btn-outline-success",3,"routerLink",4,"ngIf"],["routerLink","/orders","class","btn btn-outline-success",4,"ngIf"],[1,"btn","btn-outline-success",3,"routerLink"],["routerLink","/orders",1,"btn","btn-outline-success"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div"),t._UZ(2,"i",1),t.qZA(),t.TgZ(3,"h2"),t._uU(4,"Thank you for your purchase!"),t.qZA(),t.TgZ(5,"p",2),t._uU(6,"Your order has been successfully processed"),t.qZA(),t.YNc(7,D,2,1,"button",3),t.YNc(8,B,2,0,"button",4),t.qZA()),2&e&&(t.xp6(7),t.Q6J("ngIf",n.order),t.xp6(1),t.Q6J("ngIf",!n.order))},directives:[m.O5,v.rH],styles:[""]}),r})()}];let H=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[v.Bz.forChild($)],v.Bz]}),r})();var z=l(4466);let W=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[m.ez,H,z.m]]}),r})()}}]);